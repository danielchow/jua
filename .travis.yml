language: java

sudo: false

env:
  global:
    - secure: lcxXWbTYYKI/ZUJmEekwu9DCWVngnZUdjPnaPr13Vs9Cxs0p82MgYuoxfihY4cLLhGZbnKnN92OuOpNctKmM1pi8rkf/uGowcRLdl3czpoK9l0xLfwT4uYyra559Xgoaoion740cAhaqkOwmMCr6jXJIUBEqNFcrF60/dAyZF7P4OJPq18Oi5CXDfgUssf6HWDgqgXuPBw2fbMd4we1x6Wh1yQeVA2cYnKBAOUo+SW1OMfRal3SgrPVu0ewhg5waAoa10I64DW8p0kOsHbuCKWwPa+8vmklDiL8s6tvXQFyU0Rsl+RRQfaGpuwtZtn4UT3Tq+foQSd5+DzYgbp+5+npJVp1fhqnjXn83LHwAtEU2qEzD2R3T0t3CFmgrNia3WORE5+Mo/IMdRUzD0TBNMqHUotdYZAZhGD9JCt5aORDkFU9EQ/xCPNL7aOhehhZyrPRXPStMBNP7Qe2HERYUq59x4ScBaRQd7R33DeTGStsr+CYxodZdHAPvJWqOfMTuA1ScFUf6vfQnCqjYB4Qatr2JgBNOY4VOTc7MbyxQQAvypV1PU3uPI4Gn6IeR2LrxbaOTXntTW//5E8bh10ZN46atSFrcxmr7BEFbA+8rtB+hGeqQpmcYqPbQ8WPEnkKea6FoqlZ+g5x31E4Ssx0j6Se5MSrih8qS0lnMiwtrgCY=

addons:
  apt_packages:
    - gcc
    - g++
    - gcc-multilib
    - g++-multilib
    - binutils-mingw-w64-i686
    - binutils-mingw-w64-x86-64
    - gcc-mingw-w64-i686
    - g++-mingw-w64-i686
    - gcc-mingw-w64-x86-64
    - g++-mingw-w64-x86-64
    - lib32z1

install:
  - if [ `uname -m` = x86_64 ]; then wget http://dl.google.com/android/ndk/android-ndk-r10d-linux-x86_64.bin -O ndk.bin; else wget http://dl.google.com/android/ndk/android-ndk-r10d-linux-x86.bin -O ndk.bin; fi
  - chmod a+x ndk.bin
  - ./ndk.bin -y | grep -v Extracting
  - export NDK_HOME=`pwd`/android-ndk-r10d
  - rm -rf libs || exit 0
  - cd jni

script:
  - ant -f build-linux32.xml -Dhas-compiler=true
  - ant -f build-linux64.xml -Dhas-compiler=true
  - ant -f build-windows32.xml -Dhas-compiler=true
  - ant -f build-windows64.xml -Dhas-compiler=true
  - ant -f build-android32.xml -Dhas-ndk-build=true

after_script:
  - cd ../
  - git config --global user.email "${GIT_EMAIL}"
  - git config --global user.name "${GIT_LOGIN}"
  - git config --global push.default matching
  - echo -e "machine github.com\n  login ${GIT_LOGIN}\n  password ${GIT_PASSWORD}" >> ~/.netrc
  - echo "${GIT_LOGIN}"
  - git add libs/
  - git status -s
  - git commit -m "Built natives"
  - git branch tmp
  - git checkout master
  - git merge tmp
  - git branch -d tmp
  - git push https://github.com/non2d/non.natives.git master